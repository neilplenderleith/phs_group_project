---
title: "R Notebook"
output: html_notebook
---

##Loading necessary packages and data

```{r}
library(tidyverse)
library(janitor)
library(lubridate)

hb_agesex <- read_csv("../phs_scotland_group_project/raw_data/covid_raw_data/hospital_admissions_hb_agesex_20220302.csv") %>% 
  clean_names
board_names <- read_csv("raw_data/covid_raw_data/health_board_names.csv") %>% 
  clean_names
```

#data exploration 

```{r}
hb_agesex
board_names
```




```{r}
hb_agesex <- left_join(hb_agesex, board_names, by = "hb")

hb_agesex <- hb_agesex %>% 
  select(week_ending, hb, hbqf, age_group, age_group_qf, sex, sex_qf, admission_type, admission_type_qf, number_admissions, average20182019, percent_variation, hb_name.x) 
 

hb_agesex <- hb_agesex %>% 
  rename(hb_name = hb_name.x)
hb_agesex

hb_agesex <- hb_agesex %>% 
  mutate(hb_name = if_else(
    is.na(hb_name),
    "Scotland",
    hb_name
  ))
```



```{r}
hb_agesex <-hb_agesex %>%
  mutate(week_ending = ymd(week_ending))


```

```{r}
hb_agesex <- hb_agesex %>% 
  mutate(month = month(week_ending, label = TRUE),
         year = year(week_ending))
hb_agesex
```
##the data is relatively organised, let's start doing some plots
```{r}
hb_agesex %>% 
  filter(year == "2020", 
         admission_type  == "Emergency", 
         hb_name == "Scotland") %>% 
ggplot(aes(x = month, y = number_admissions))+
  geom_col(fill = "light blue")

hb_agesex %>% 
  filter(year == "2021", 
         admission_type  == "Emergency", 
         hb_name == "Scotland") %>% 
ggplot(aes(x = month, y = number_admissions))+
  geom_col(fill = "light blue")

hb_agesex %>% 
  filter(year == "2022", 
         admission_type  == "Emergency", 
         hb_name == "Scotland") %>% 
ggplot(aes(x = month, y = number_admissions))+
  geom_col(fill = "light blue")
```


##demographic investigation 

```{r}
hb_simd <- read_csv("raw_data/covid_raw_data/hospital_admissions_hb_simd_20220302.csv") %>% 
  clean_names()
hb_simd
```

```{r}
hb_simd <- left_join(hb_simd, board_names, by = "hb")

hb_simd <- hb_simd %>% 
  select(week_ending, hb, hbqf, simd_quintile, admission_type, admission_type_qf, number_admissions, average20182019, percent_variation, hb_name) 
 hb_simd



hb_simd <- hb_simd %>% 
  mutate(hb_name = if_else(
    is.na(hb_name),
    "Scotland",
    hb_name
  ))
```

```{r}
hb_simd <- hb_simd %>%
  mutate(week_ending = ymd(week_ending))

hb_simd <- hb_simd %>% 
  mutate(month = month(week_ending, label = TRUE),
         year = year(week_ending))
hb_simd
```


```{r}
hb_simd %>% 
  distinct(simd_quintile)
```

```{r}
hb_simd %>% 
  filter(year == "2020", 
         hb_name == "Scotland", 
         admission_type == "Emergency") %>% 
ggplot(aes(x = simd_quintile, y = number_admissions))+
  geom_col()
```


